
# SONiC-MGMT Server Configuration Architecture Difference Report

This document compares the customized `server_config` mechanism with the original [sonic-mgmt](https://github.com/sonic-net/sonic-mgmt) `ansible/` structure. It explains the use of symbolic links, the purpose of each file, and the motivation behind the modifications.

---

## Architecture Comparison Overview

| Item | Community sonic-mgmt | Custom server_config Design |
|------|-----------------------|------------------------------|
| Configuration Source | Static files under `ansible/` | Centralized in `ansible_config/`, dynamically generated by `server.sh` |
| Testbed Switching | No native multi-env support | Supports `server.sh [1~8]` for selecting testbed configs |
| host_vars/group_vars/files | All YAML/CSV static files | Templates (`.j2`) rendered to `.yml/.csv` then symlinked into `ansible/` |
| Symbolic Link Usage | Rarely used | All `ansible_config` files symlinked into `ansible/` |

---

## Directory Structure Comparison

### Community sonic-mgmt ansible Layout (Static)

```bash
sonic-mgmt/
└── ansible/
    ├── testbed.csv
    ├── group_vars/
    │   ├── all/
    │   ├── eos/
    ├── host_vars/
    ├── vars/
    ├── files/
    └── testbed-cli.sh
```

### Custom server_config Structure (Generated by server.sh)

```bash
sonic-mgmt/
├── server_config/
│   ├── sonic-mgmt/ansible/*.j2
│   └── server.sh, server_config_generate.py
├── ansible_config/  ← dynamically generated files
│   ├── testbed.csv, vtestbed.csv
│   ├── group_vars/
│   ├── host_vars/
│   ├── vars/
│   ├── files/
│   └── ...
└── ansible/         ← symlink injected
    ├── testbed.csv              → ../ansible_config/testbed.csv
    ├── vtestbed.yaml            → ../ansible_config/vtestbed.yaml
    ├── files/                   → ../ansible_config/files/
    ├── group_vars/              → ../ansible_config/group_vars/
    ├── host_vars/               → ../ansible_config/host_vars/
    └── vars/                    → ../ansible_config/vars/
```

---

## Symbolic Link Mapping Structure

```bash
ansible/
├── testbed.csv           → ../ansible_config/testbed.csv
├── vtestbed.yaml         → ../ansible_config/vtestbed.yaml
├── group_vars/
│   ├── all/              → ../ansible_config/group_vars/all/
│   ├── eos/              → ../ansible_config/group_vars/eos/
│   ├── vm_host/          → ../ansible_config/group_vars/vm_host/
│   └── lab/              → ../ansible_config/group_vars/lab/
├── host_vars/            → ../ansible_config/host_vars/
├── files/                → ../ansible_config/files/
├── vars/                 → ../ansible_config/vars/
```

---

## Directory/File Purpose Overview

| Type | File/Directory | Purpose |
|------|----------------|---------|
| Testbed Topology | `testbed.csv` / `vtestbed.csv` | Defines testbed topology, DUT/PTF hosts |
| group_vars | `group_vars/all/` etc. | Global test variables like timezone, lab info, login credentials |
| host_vars | `host_vars/STR-*.yml` | Per-device hostname, IP, special configs |
| files | `sonic_lab_links.csv` etc. | Physical connectivity for DUT, fanout, PDU, console |
| vars | `docker_registry.yml` | Docker image URLs, server routing configs |

---

## Benefits of This Design

- Clear separation of templates (`.j2`) and rendered files (`.yml`/`.csv`)
- Multiple server testbeds supported by `server.sh` input parameter
- Symbolic link structure maintains compatibility with upstream `ansible/`
- Extensible for Jenkins CI with automated testbed and log mapping support

---
